<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>File constraints &#8212; RadlerManual 1 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">RadlerManual 1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="file-constraints">
<h1>File constraints<a class="headerlink" href="#file-constraints" title="Permalink to this headline">¶</a></h1>
<p>A radl description file is a text file, preferably encoded in utf8, with
extension &#8221;.radl&#8221;. Such a file is called in short a radl file.</p>
</div>
<div class="section" id="meta-syntax-rules">
<h1>Meta syntax rules<a class="headerlink" href="#meta-syntax-rules" title="Permalink to this headline">¶</a></h1>
<p>A radl file define a module whose name is the file name. A module is a
set of value declarations. A declaration may be an alias, used to
declare a value equal to another one but with a new name. The name of a
value may be omitted, note that it&#8217;ll prevent the user to reference this
value. The type of a value may also be omitted, note that if the type is
ambiguous, the inference will choose one. When defining a class field,
one may declare a new value or refer to another value by its
identifier.</p>
<div class="section" id="grammar">
<h2>Grammar<a class="headerlink" href="#grammar" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span>module := decl*
decl := alias | NAME? (&#39;:&#39; TYPE)? TYPEVALUE | NAME? (&#39;:&#39; CLASS)? class_value
alias := NAME = identifier
class_value := &#39;{&#39; field * &#39;}&#39;
field := FIELDNAME value +
value := identifier | decl
identifier := root_name | identifier &#39;.&#39; NAME
root_name := NAME
</pre></div>
</div>
</div>
<div class="section" id="grammar-terminals">
<h2>Grammar terminals<a class="headerlink" href="#grammar-terminals" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">NAME</span></code> terminal is a spaceless word beginning with a letter which
may contain numbers and underscore (the regex
<code class="docutils literal"><span class="pre">[a-zA-Z][a-zA-Z0-9_]*</span></code>). <code class="docutils literal"><span class="pre">NAME</span></code> is also restricted not to be a
keyword, or begin with &#8216;radl&#8217;. The other terminals are defined by the
<a class="reference external" href="https://github.com/SRI-CSL/radler/blob/master/radler/radlr/language.py">language.py</a> file, with
declarations of the form</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s1">&#39;type&#39;</span> <span class="n">TYPE</span> <span class="s1">&#39;REGEX&#39;</span> <span class="n">TYPEVALUE</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&#39;class&#39; CLASS (FIELDNAME (TYPE|CLASS) (&#39;*&#39;|&#39;+&#39;|&#39;?&#39;)?)*
</pre></div>
</div>
</div>
<div class="section" id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<p>Keywords are all <code class="docutils literal"><span class="pre">TYPE</span></code>, <code class="docutils literal"><span class="pre">CLASS</span></code> and <code class="docutils literal"><span class="pre">FIELDNAME</span></code> plus the
<code class="docutils literal"><span class="pre">extra_keywords</span></code> entry of
<a class="reference external" href="https://github.com/SRI-CSL/radler/blob/master/radler/radlr/language.py">language.py</a>.</p>
</div>
<div class="section" id="white-spaces">
<h2>White spaces<a class="headerlink" href="#white-spaces" title="Permalink to this headline">¶</a></h2>
<p>The syntax requires all terminals to be whitespace separated. A whitespace is any number greater than 1 of space, tabulation and end of line.</p>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<p>After <code class="docutils literal"><span class="pre">#</span></code>, any character is discarded up to the end of line.</p>
</div>
</div>
<div class="section" id="identifier-scoping-rules">
<h1>Identifier scoping rules<a class="headerlink" href="#identifier-scoping-rules" title="Permalink to this headline">¶</a></h1>
<div class="section" id="scoping-regions">
<h2>Scoping regions<a class="headerlink" href="#scoping-regions" title="Permalink to this headline">¶</a></h2>
<p>A file <code class="docutils literal"><span class="pre">MODULE</span></code>.radl defines an implicit scoping region for its
content whose name is <code class="docutils literal"><span class="pre">MODULE</span></code>. Sub-regions are defined by class
values. A class value declaration defines one and only one nested
scoping region, syntactically delimited by matching braces, whose name
is the declaration <code class="docutils literal"><span class="pre">NAME</span></code>.</p>
</div>
<div class="section" id="local-unicity-of-names">
<h2>Local unicity of names<a class="headerlink" href="#local-unicity-of-names" title="Permalink to this headline">¶</a></h2>
<p>Inside each region (not comprising its sub-regions), <code class="docutils literal"><span class="pre">NAME</span></code> of each
declarations are unique. Moreover, each module name <code class="docutils literal"><span class="pre">MODULE</span></code> is
ensured to be unique.</p>
</div>
<div class="section" id="global-unicity-of-qualified-names">
<h2>Global unicity of qualified names<a class="headerlink" href="#global-unicity-of-qualified-names" title="Permalink to this headline">¶</a></h2>
<p>A qualified name (qname) is an identifier whose <code class="docutils literal"><span class="pre">root_name</span></code> is a
module name. By unicity of module names and declaration names, a qname
defines a value uniquely.</p>
</div>
<div class="section" id="resolution-of-identifiers-to-qualified-names">
<h2>Resolution of identifiers to qualified names<a class="headerlink" href="#resolution-of-identifiers-to-qualified-names" title="Permalink to this headline">¶</a></h2>
<p>When resolving an identifier, the first step is the resolution of its
<code class="docutils literal"><span class="pre">root_name</span></code>, which is match with the closest enclosing scoping region
or in last resort to another module name. At that point, the
<code class="docutils literal"><span class="pre">root_name</span></code> is replaced by the qualified name of its matching region
and the identifier becomes a qualified name.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----</span> <span class="n">file</span><span class="p">:</span> <span class="n">module1</span><span class="o">.</span><span class="n">radl</span> <span class="o">----</span>
<span class="n">x</span> <span class="p">:</span> <span class="n">int32</span> <span class="mi">0</span>
<span class="n">s</span> <span class="p">:</span> <span class="n">struct</span> <span class="p">{</span> <span class="n">FIELDS</span> <span class="n">x</span> <span class="p">:</span> <span class="n">int32</span> <span class="mi">42</span> <span class="p">}</span>
<span class="o">----------------------------</span>
</pre></div>
</div>
<p>This file declares three values whose qnames are <code class="docutils literal"><span class="pre">module1.x</span></code>,
<code class="docutils literal"><span class="pre">module1.s</span></code> and <code class="docutils literal"><span class="pre">module1.s.x</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----</span> <span class="n">file</span><span class="p">:</span> <span class="n">module2</span><span class="o">.</span><span class="n">radl</span> <span class="o">----</span>
<span class="n">x</span> <span class="p">:</span> <span class="n">int32</span> <span class="mi">0</span>
<span class="n">s</span> <span class="p">:</span> <span class="n">struct</span> <span class="p">{</span> <span class="n">FIELDS</span>
    <span class="n">x</span> <span class="p">:</span> <span class="n">int32</span> <span class="mi">0</span>
    <span class="n">s2</span> <span class="p">:</span> <span class="n">struct</span> <span class="p">{</span> <span class="n">FIELDS</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">module2</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">module2</span><span class="o">.</span><span class="n">x</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">module1</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="o">----------------------------</span>
</pre></div>
</div>
<p>This file declares nine values whose qnames are <code class="docutils literal"><span class="pre">module2.x</span></code>,
<code class="docutils literal"><span class="pre">module2.s</span></code>, <code class="docutils literal"><span class="pre">module2.s.x</span></code>, <code class="docutils literal"><span class="pre">midule2.s.s2</span></code>, <code class="docutils literal"><span class="pre">module2.s.s2.y</span></code>,
<code class="docutils literal"><span class="pre">module2.s.s2.y2</span></code>, <code class="docutils literal"><span class="pre">module2.s.s2.y3</span></code>, <code class="docutils literal"><span class="pre">module2.s.s2.z</span></code>, and
<code class="docutils literal"><span class="pre">module2.s.s2.a</span></code>. When defining the alias <code class="docutils literal"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">x</span></code>, the identifier
<code class="docutils literal"><span class="pre">x</span></code> is resolved by looking for a name <code class="docutils literal"><span class="pre">x</span></code> defined in <code class="docutils literal"><span class="pre">s2</span></code> (which
doesn&#8217;t exist) then in the enclosing region <code class="docutils literal"><span class="pre">s</span></code> where it is found,
thus resolving to <code class="docutils literal"><span class="pre">module2.s.x</span></code>. <code class="docutils literal"><span class="pre">s.x</span></code> in the declaration of <code class="docutils literal"><span class="pre">y2</span></code>
is resolved to the same qname by first resolving <code class="docutils literal"><span class="pre">s</span></code> to <code class="docutils literal"><span class="pre">module2.s</span></code>
and replacing it to get <code class="docutils literal"><span class="pre">module2.s.x</span></code>. When resolving the identifiers
<code class="docutils literal"><span class="pre">module2.s.x</span></code>, <code class="docutils literal"><span class="pre">module2.x</span></code>, and <code class="docutils literal"><span class="pre">module1.s.x</span></code>, the <code class="docutils literal"><span class="pre">root_name</span></code> is
found to be a module name meaning that these identifiers are already
qualified names.</p>
</div>
</div>
<div class="section" id="shadowing">
<h2>Shadowing<a class="headerlink" href="#shadowing" title="Permalink to this headline">¶</a></h2>
<p>While using qualified names for identifiers permit to overcome most
possible shadowings, a region will shadow any module with identical
name.</p>
<div class="section" id="id1">
<h3>Example<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">---</span> <span class="n">file</span><span class="p">:</span> <span class="n">module3</span><span class="o">.</span><span class="n">radl</span> <span class="o">---</span>

<span class="n">module1</span> <span class="p">:</span> <span class="n">struct</span> <span class="p">{</span> <span class="n">FIELDS</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">module1</span><span class="o">.</span><span class="n">x</span>
<span class="p">}</span>
<span class="o">--------------------------</span>
</pre></div>
</div>
<p>In this file, the resolution of <code class="docutils literal"><span class="pre">module1.x</span></code> will result in
<code class="docutils literal"><span class="pre">module3.module1.x</span></code> since the closest enclosing region named
<code class="docutils literal"><span class="pre">module1</span></code> is the one defined in <code class="docutils literal"><span class="pre">module3</span></code>. Thus the definition of
the struct named <code class="docutils literal"><span class="pre">module1</span></code> shadow the actual module <code class="docutils literal"><span class="pre">module1</span></code>.
Note that in this example, since <code class="docutils literal"><span class="pre">module3.module1.x</span></code> isn&#8217;t
declared, the compiler will complain about it missing.</p>
</div>
</div>
</div>
<div class="section" id="the-radler-language">
<h1>The radler language<a class="headerlink" href="#the-radler-language" title="Permalink to this headline">¶</a></h1>
<div class="section" id="logical-level">
<h2>Logical level<a class="headerlink" href="#logical-level" title="Permalink to this headline">¶</a></h2>
<p>The two main classes used to describe the logical level are node and
topic. Their full definitions may be found in
<a class="reference external" href="https://github.com/SRI-CSL/radler/blob/master/radler/radlr/language.py">language.py</a>. The most
important elements are:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">node</span>
    <span class="n">PUBLISHES</span> <span class="n">publication</span> <span class="o">*</span>
    <span class="n">SUBSCRIBES</span> <span class="n">subscription</span> <span class="o">*</span>
    <span class="n">CXX</span> <span class="n">cxx_class</span>
    <span class="n">PERIOD</span> <span class="n">duration</span>
    <span class="n">WCET</span> <span class="n">duration</span>
<span class="k">class</span> <span class="nc">topic</span>
    <span class="n">FIELDS</span> <span class="n">int8</span><span class="o">/</span><span class="n">uint8</span><span class="o">/</span><span class="n">int16</span><span class="o">/</span><span class="n">uint16</span><span class="o">/</span><span class="n">int32</span><span class="o">/</span><span class="n">uint32</span><span class="o">/</span><span class="n">int64</span><span class="o">/</span><span class="n">uint64</span><span class="o">/</span>
           <span class="n">float32</span><span class="o">/</span><span class="n">float64</span><span class="o">/</span>
           <span class="nb">bool</span><span class="o">/</span><span class="n">struct</span><span class="o">/</span><span class="n">array</span><span class="o">/</span><span class="n">duration</span><span class="o">/</span><span class="n">time</span> <span class="o">+</span>
</pre></div>
</div>
<div class="section" id="nodes">
<h3>Nodes<a class="headerlink" href="#nodes" title="Permalink to this headline">¶</a></h3>
<p>When creating a node, radler will construct one instance of the
provided C++ class (the <code class="docutils literal"><span class="pre">CXX</span></code> field). The step method of this
instance will be called at a fixed frequency defined by the node&#8217;s
period (the <code class="docutils literal"><span class="pre">PERIOD</span></code> field). This step function needs to be proven
to have a worst case execution time inferior to the one described
here in the <code class="docutils literal"><span class="pre">WCET</span></code> field. At each call, the step function is
provided with the messages received from its subscriptions and is
required to write the messages it has to publish.</p>
</div>
<div class="section" id="topics">
<h3>Topics<a class="headerlink" href="#topics" title="Permalink to this headline">¶</a></h3>
<p>A topic (defined uniquely by its name) is a purely logical way to
define point to point communications between one producer and
multiple consumers. There needs to be one and only one node
publishing to a topic while as many as needed nodes subscribing to
it.</p>
</div>
</div>
<div class="section" id="external-files-and-path">
<h2>External files and <code class="docutils literal"><span class="pre">PATH</span></code><a class="headerlink" href="#external-files-and-path" title="Permalink to this headline">¶</a></h2>
<div class="section" id="file-reference">
<h3>File reference<a class="headerlink" href="#file-reference" title="Permalink to this headline">¶</a></h3>
<p>An external file is described by a string representing its path. This
path may be absolute (for example &#8220;/etc/example.cfg&#8221;) or relative
(&#8220;src/defs.h&#8221;). Relative paths are resolved relatively to the working
directory of the scoping region. Absolute path files are not
recommended, but may be useful in very specific cases.</p>
</div>
<div class="section" id="working-directory-of-a-region-path-and-module-base-path">
<h3>Working directory of a region, <code class="docutils literal"><span class="pre">PATH</span></code> and <code class="docutils literal"><span class="pre">MODULE_BASE_PATH</span></code><a class="headerlink" href="#working-directory-of-a-region-path-and-module-base-path" title="Permalink to this headline">¶</a></h3>
<p>If a <code class="docutils literal"><span class="pre">PATH</span></code> field exists in a region, it is used to set the working
directory of this region relatively to the parent region&#8217;s working
directory. The module working directory is the directory of the
module file except when it is redefined by the <code class="docutils literal"><span class="pre">MODULE_BASE_PATH</span></code>
of the <code class="docutils literal"><span class="pre">module_settings</span></code> value.</p>
</div>
<div class="section" id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----</span> <span class="n">file</span><span class="p">:</span> <span class="n">path1</span><span class="o">.</span><span class="n">radl</span> <span class="o">----</span>
<span class="n">n</span><span class="p">:</span> <span class="n">node</span> <span class="p">{</span>
    <span class="n">PATH</span> <span class="s2">&quot;nodes/example&quot;</span>
    <span class="n">CXX</span> <span class="p">{</span> <span class="n">PATH</span> <span class="s2">&quot;src&quot;</span> <span class="n">FILENAME</span> <span class="s2">&quot;n.cpp&quot;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="o">--------------------------</span>
</pre></div>
</div>
<p>Considering that path1.radl is in &#8220;/tmp/pathexample&#8221;, the working
directory inside the region <code class="docutils literal"><span class="pre">n</span></code> is &#8220;/tmp/pathexample/nodes/example&#8221;
and the file refered by &#8220;n.cpp&#8221; is
&#8220;/tmp/pathexample/nodes/example/src/n.cpp&#8221;</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----</span> <span class="n">file</span><span class="p">:</span> <span class="n">path2</span><span class="o">.</span><span class="n">radl</span> <span class="o">----</span>
<span class="n">n</span><span class="p">:</span> <span class="n">node</span> <span class="p">{</span>
    <span class="n">PATH</span> <span class="s2">&quot;nodes/example&quot;</span>
    <span class="n">CXX</span> <span class="p">{</span> <span class="n">PATH</span> <span class="s2">&quot;src&quot;</span> <span class="n">FILENAME</span> <span class="s2">&quot;n.cpp&quot;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">settings</span> <span class="p">:</span> <span class="n">module_settings</span> <span class="p">{</span>
    <span class="n">MODULE_BASE_PATH</span> <span class="s2">&quot;/usr/pathexample&quot;</span>
<span class="p">}</span>
<span class="o">--------------------------</span>
</pre></div>
</div>
<p>By adding this <code class="docutils literal"><span class="pre">module_settings</span></code> value, &#8220;n.cpp&#8221; refers to
&#8220;/usr/pathexample/nodes/example/src/n.cpp&#8221;.</p>
</div>
</div>
<div class="section" id="libraries">
<h2>Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h2>
<p>Any user code needing libraries has to be declared as using a library
with the <code class="docutils literal"><span class="pre">LIB</span></code> field. This field allows two forms of libraries,
<code class="docutils literal"><span class="pre">cmake_library</span></code> and <code class="docutils literal"><span class="pre">static_library</span></code>.</p>
<div class="section" id="static-library">
<h3>Static library<a class="headerlink" href="#static-library" title="Permalink to this headline">¶</a></h3>
<p>Static libraries are of the simplest form, gathering a set of source
files in their <code class="docutils literal"><span class="pre">CXX</span></code> field while the library header files are found
in the <code class="docutils literal"><span class="pre">HEADER_PATHS</span></code> paths.</p>
</div>
<div class="section" id="cmake-library">
<h3>Cmake library<a class="headerlink" href="#cmake-library" title="Permalink to this headline">¶</a></h3>
<p>The cmake library enables the use of arbitrarily complex libraries
since it is a user defined cmake script. The <code class="docutils literal"><span class="pre">CMAKE_MODULE</span></code> field
provide the cmake module name used to find it in the working
directory. <code class="docutils literal"><span class="pre">COMPONENTS</span></code> are the required components from this
module, used when calling the cmake <code class="docutils literal"><span class="pre">find_module</span></code> command. By
default, it is expected that the module defines two variables named
<code class="docutils literal"><span class="pre">${CMAKE_MODULE}_LIBRARIES</span></code> and <code class="docutils literal"><span class="pre">${CMAKE_MODULE}_INCLUDE_DIRS</span></code>
defining respectively the libraries to be linked against and the
include directories. Both variable names can be specified if their
naming doesn&#8217;t follow this convention, respectively with the fields
<code class="docutils literal"><span class="pre">CMAKE_VAR_LIBRARIES</span></code> and <code class="docutils literal"><span class="pre">CMAKE_VAR_INCLUDE_DIRS</span></code>.</p>
</div>
</div>
<div class="section" id="typing">
<h2>Typing<a class="headerlink" href="#typing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="inference">
<h3>Inference<a class="headerlink" href="#inference" title="Permalink to this headline">¶</a></h3>
<p>When a value is type annotated, it is checked to be of this type. If no
type annotation is provided, the kind of the value is looked among
the ones possible in the value declaration context. If there is an
ambiguity, is chosen the first fitting in the order of declaration
in <a class="reference external" href="https://github.com/SRI-CSL/radler/blob/master/radler/radlr/language.py">language.py</a>.</p>
</div>
<div class="section" id="checking">
<h3>Checking<a class="headerlink" href="#checking" title="Permalink to this headline">¶</a></h3>
<p>User values are checked to be correct with their type with the
function <code class="docutils literal"><span class="pre">check_type</span></code> found in
<a class="reference external" href="https://github.com/SRI-CSL/radler/blob/master/radler/radlr/language.py">language.py</a>.</p>
</div>
<div class="section" id="subtyping">
<h3>Subtyping<a class="headerlink" href="#subtyping" title="Permalink to this headline">¶</a></h3>
<p>Subtyping allows for example to use a 16bits integer (<code class="docutils literal"><span class="pre">int16</span></code>)
where a 32bits integer is required (<code class="docutils literal"><span class="pre">int32</span></code>). For now, subtyping is
only done on <code class="docutils literal"><span class="pre">sized_types</span></code> by allowing a type to be used in a
bigger version. <code class="docutils literal"><span class="pre">sized_types</span></code> and possible sizes are explicit in
<a class="reference external" href="https://github.com/SRI-CSL/radler/blob/master/radler/radlr/language.py">language.py</a>. User values
are checked to fit the type&#8217;s size with the function
<code class="docutils literal"><span class="pre">check_type_size</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="user-code">
<h1>User code<a class="headerlink" href="#user-code" title="Permalink to this headline">¶</a></h1>
<div class="section" id="compilation">
<h2>Compilation<a class="headerlink" href="#compilation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="include-directories">
<h3>Include directories<a class="headerlink" href="#include-directories" title="Permalink to this headline">¶</a></h3>
<p>The generated code is setup so that user code is compiled with the
necessary include folders, meaning specified libraries header folders
and the working directory of the file references.</p>
</div>
<div class="section" id="compiler-definitions">
<h3>Compiler definitions<a class="headerlink" href="#compiler-definitions" title="Permalink to this headline">¶</a></h3>
<p>The user code is compiled with the following definitions:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">IN_RADL_GENERATED_CONTEXT</span></code> : the basic definition to detect if the code is compiled within RADL compilation chain.</li>
<li><code class="docutils literal"><span class="pre">RADL_NODE_NAME</span></code> : the name of the current radl node.</li>
<li><code class="docutils literal"><span class="pre">RADL_NODE_QNAME</span></code> : which is set to the node qname (with dot separators, for example &#8220;<code class="docutils literal"><span class="pre">modulename.nodename</span></code>&#8221;).</li>
<li><code class="docutils literal"><span class="pre">RADL_MODULE_NAME</span></code> : the name of the current radl module.</li>
<li><code class="docutils literal"><span class="pre">RADL_MODULE</span></code> : a pointer to the current module ast root.</li>
<li><code class="docutils literal"><span class="pre">RADL_HEADER</span></code> : the radl generated header to be included by the user code (defining input and output data types).</li>
<li><code class="docutils literal"><span class="pre">RADL_STATE</span></code> : the radl default name to be used for the C state type (if not specified in the radl file).</li>
<li><code class="docutils literal"><span class="pre">RADL_STEP_FUN</span></code> : the default name to be used for the C step function (if not specified in the radl file).</li>
<li><code class="docutils literal"><span class="pre">RADL_INIT_FUN</span></code> : the default name to be used for the C init function (if not specified in the radl file).</li>
<li><code class="docutils literal"><span class="pre">RADL_FINISH_FUN</span></code> : the default name to be used for the C finish function (if not specified in the radl file).</li>
</ul>
</div>
</div>
<div class="section" id="c-node-definition">
<h2>C++ node definition<a class="headerlink" href="#c-node-definition" title="Permalink to this headline">¶</a></h2>
<p>Every node is a mealy machine. The user provide a class which will be
instantiated with the default constructor to generate an instance
representing the state of the machine. Then, the <code class="docutils literal"><span class="pre">step</span></code> method of this
instance will be called to execute one step of the machine. The
signature of the <code class="docutils literal"><span class="pre">step</span></code> method is required to be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">step</span><span class="p">(</span><span class="n">const</span> <span class="n">radl_in_t</span><span class="o">*</span><span class="p">,</span> <span class="n">const</span> <span class="n">radl_inflags_t</span><span class="o">*</span><span class="p">,</span> <span class="n">radl_out_t</span><span class="o">*</span><span class="p">,</span> <span class="n">radl_outflags_t</span><span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>The four argument types are structures defined in the generated header
file.</p>
<div class="section" id="the-input-structure-radl-in-t">
<h3>The input structure <code class="docutils literal"><span class="pre">radl_in_t</span></code><a class="headerlink" href="#the-input-structure-radl-in-t" title="Permalink to this headline">¶</a></h3>
<p>This structure has one field per subscription of the node. The field
name is the radl name of the subscription. Each field is in turn a
structure reflecting the topic of the subscription, whose fields are
the name of the radl topic <code class="docutils literal"><span class="pre">FIELDS</span></code>.</p>
</div>
<div class="section" id="the-output-structure-radl-out-t">
<h3>The output structure <code class="docutils literal"><span class="pre">radl_out_t</span></code><a class="headerlink" href="#the-output-structure-radl-out-t" title="Permalink to this headline">¶</a></h3>
<p>It is similar to the input structure except that is is used by the
step function to publish its publications. To this effect, the step
function has to fill the output structure.</p>
</div>
<div class="section" id="the-flag-structures-radl-in-flags-t-radl-out-flags-t">
<h3>The flag structures <code class="docutils literal"><span class="pre">radl_in_flags_t</span></code>, <code class="docutils literal"><span class="pre">radl_out_flags_t</span></code><a class="headerlink" href="#the-flag-structures-radl-in-flags-t-radl-out-flags-t" title="Permalink to this headline">¶</a></h3>
<p>Similarly to the input and output structures, these have a field for
each subscription (resp. publication). The type of each field is a
<code class="docutils literal"><span class="pre">radl_flags_t</span></code> as described in
<a class="reference external" href="https://github.com/SRI-CSL/radler/blob/master/radl_lib/include/radl_flags.h">radl_flags.h</a>.</p>
</div>
</div>
<div class="section" id="id3">
<h2>C node definition<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Idem as the C++, except that instead of a class, the user needs to
provide 4 things. To describe them, we use the default names provided by
radl, but those may be decided in the radl file.</p>
<ul class="simple">
<li>A state type, that we call <code class="docutils literal"><span class="pre">RADL_STATE</span></code> here</li>
<li>An init function of signature : <code class="docutils literal"><span class="pre">void</span> <span class="pre">RADL_INIT_FUN(RADL_STATE</span> <span class="pre">*)</span></code></li>
<li>A step function of signature :
<code class="docutils literal"><span class="pre">void</span> <span class="pre">RADL_STEP_FUN(RADL_STATE</span> <span class="pre">*,</span> <span class="pre">const</span> <span class="pre">radl_in_t*,</span> <span class="pre">const</span> <span class="pre">radl_inflags_t*,</span> <span class="pre">radl_out_t*,</span> <span class="pre">radl_outflags_t*)</span></code></li>
<li>A finish function of signature :
<code class="docutils literal"><span class="pre">void</span> <span class="pre">RADL_FINISH_FUN(RADL_STATE</span> <span class="pre">*)</span></code></li>
</ul>
</div>
<div class="section" id="the-flags">
<h2>The flags<a class="headerlink" href="#the-flags" title="Permalink to this headline">¶</a></h2>
<div class="section" id="computation-of-the-output-flags">
<h3>Computation of the output flags<a class="headerlink" href="#computation-of-the-output-flags" title="Permalink to this headline">¶</a></h3>
<p>The main idea of flags is to have some boolean metadata attached to
messages, which by default propagate through nodes. To this effect,
the default value of the output flags of each publication of a node
are set to the logical OR of all the flags of its subscriptions,
equivalent to the following pseudo code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="n">each</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subscriptions</span><span class="p">:</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="n">OR</span> <span class="n">in_flags</span><span class="o">-&gt;</span><span class="n">s</span>
<span class="k">for</span> <span class="n">each</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">publications</span><span class="p">:</span>
    <span class="n">out_flags</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">=</span> <span class="n">v</span>
</pre></div>
</div>
<p>Then, the input flags are given to the step function as read-only
while the pre set output flags are provided to the step function to
give it a chance to turn on or off the desired flags. So, if the step
function doesn&#8217;t change the output flags, they will propagate the
input flags.</p>
</div>
<div class="section" id="computation-of-the-input-flag-radl-stale">
<h3>Computation of the input flag <code class="docutils literal"><span class="pre">radl_STALE</span></code><a class="headerlink" href="#computation-of-the-input-flag-radl-stale" title="Permalink to this headline">¶</a></h3>
<p>The so called stale flag has the broad meaning that its associated
value isn&#8217;t &#8220;fresh&#8221;. More precisely, it either means that the
publisher of the value flagged it as stale (by automatic propagation
or by choice) or that no new message arrived since the last call to
the step function. In the latter case, the step function gets the
same input value (the mailbox hasn&#8217;t changed) but it is flagged as
stale. To check if a subscription <code class="docutils literal"><span class="pre">s</span></code> is stale, one simply calls
<code class="docutils literal"><span class="pre">radl_is_stale(in_flags-&gt;s)</span></code> which returns a boolean.</p>
</div>
<div class="section" id="computation-of-the-input-flag-radl-timeout">
<h3>Computation of the input flag <code class="docutils literal"><span class="pre">radl_TIMEOUT</span></code><a class="headerlink" href="#computation-of-the-input-flag-radl-timeout" title="Permalink to this headline">¶</a></h3>
<p>The so called timeout flag has the broad meaning that its associated
value has violated the timing constraints. More precisely, it either
means that the publisher of the value flagged it as timeout (by
automatic propagation or by choice) or that we haven&#8217;t received a
message since period of the publisher plus the maxlatency. In the
latter case, timing constraints are exceeded and something unexpected
is happening. To check if a subscription <code class="docutils literal"><span class="pre">s</span></code> is timeout, one simply
calls <code class="docutils literal"><span class="pre">radl_is_timeout(in_flags-&gt;s)</span></code> which returns a boolean.</p>
</div>
<div class="section" id="turning-off-on-output-flags">
<h3>Turning off/on output flags<a class="headerlink" href="#turning-off-on-output-flags" title="Permalink to this headline">¶</a></h3>
<p>The function <code class="docutils literal"><span class="pre">radl_turn_on</span></code> is used to turn on a flag. For example
to turn on the stale flag of the publication <code class="docutils literal"><span class="pre">p</span></code>, we would do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">radl_turn_on</span><span class="p">(</span><span class="n">rald_STALE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">out_flags</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">);</span>
</pre></div>
</div>
<p>To turn off flags, the similar function <code class="docutils literal"><span class="pre">rald_turn_off</span></code> should be
used.</p>
</div>
</div>
<div class="section" id="introspection">
<h2>Introspection<a class="headerlink" href="#introspection" title="Permalink to this headline">¶</a></h2>
<p>To allow more robust and generic user code, it is possible to access
values defined in the radl description.</p>
<div class="section" id="modules-root-entries">
<h3>Modules root entries<a class="headerlink" href="#modules-root-entries" title="Permalink to this headline">¶</a></h3>
<p>The generic way of doing so is to use the generated module root ast
access functions. For example if we want to read the radl value of
qname <code class="docutils literal"><span class="pre">module1.x</span></code>, one will first call the <code class="docutils literal"><span class="pre">radlast_module1</span></code>
function to get to the module root entry.</p>
</div>
<div class="section" id="shortcuts">
<h3>Shortcuts<a class="headerlink" href="#shortcuts" title="Permalink to this headline">¶</a></h3>
<p>Instead of needing to know the current module name and call the
corresponding root ast access function, one can use the provided
macro <code class="docutils literal"><span class="pre">RADL_MODULE</span></code>. When writing a step function, one can directly
access the node it is used in by using the <code class="docutils literal"><span class="pre">RADL_THIS</span></code> macro.</p>
</div>
<div class="section" id="field-access">
<h3>Field access<a class="headerlink" href="#field-access" title="Permalink to this headline">¶</a></h3>
<p>The generic rule is that fields of values are the names of the
declared value inside this value. This name is in turn</p>
<ul class="simple">
<li>a pointer to the value (the generic case)</li>
<li>the value itself (for a <code class="docutils literal"><span class="pre">topic</span></code>, a <code class="docutils literal"><span class="pre">struct</span></code> or inside them).</li>
</ul>
</div>
<div class="section" id="the-defs-field">
<h3>The <code class="docutils literal"><span class="pre">DEFS</span></code> field<a class="headerlink" href="#the-defs-field" title="Permalink to this headline">¶</a></h3>
<p>To allow the user to define values which are not radl relevant, but
that should be statically defined and shared, we added the <code class="docutils literal"><span class="pre">DEFS</span></code>
field in the <code class="docutils literal"><span class="pre">node</span></code> and <code class="docutils literal"><span class="pre">topic</span></code> classes.</p>
</div>
<div class="section" id="id4">
<h3>Example<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Let us consider we have the following radl description.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----</span> <span class="n">file</span><span class="p">:</span> <span class="n">introspec</span><span class="o">.</span><span class="n">radl</span> <span class="o">----</span>
<span class="n">x</span> <span class="p">:</span> <span class="n">int32</span> <span class="mi">1</span>
<span class="n">t</span> <span class="p">:</span> <span class="n">topic</span> <span class="p">{</span> <span class="n">FIELDS</span>
    <span class="n">a</span> <span class="p">:</span> <span class="n">int32</span> <span class="mi">2</span>
<span class="p">}</span>
<span class="n">n</span> <span class="p">:</span> <span class="n">node</span> <span class="p">{</span>
    <span class="n">DEFS</span>
        <span class="n">y</span> <span class="p">:</span> <span class="n">int32</span> <span class="mi">3</span>
        <span class="n">s</span> <span class="p">:</span> <span class="n">struct</span> <span class="p">{</span> <span class="n">FIELDS</span>
            <span class="n">z</span> <span class="p">:</span> <span class="n">int32</span> <span class="mi">4</span>
        <span class="p">}</span>
    <span class="n">PATH</span> <span class="n">working_dir</span> <span class="s2">&quot;nodes/example&quot;</span>
    <span class="n">CXX</span> <span class="p">{</span> <span class="n">PATH</span> <span class="s2">&quot;src&quot;</span> <span class="n">FILENAME</span> <span class="s2">&quot;n.cpp&quot;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="o">----------------------------</span>
</pre></div>
</div>
<p>In the user code, if one desire to get the value of <code class="docutils literal"><span class="pre">x</span></code> (1), it has
to do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">(</span><span class="n">radlast_introspec</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">(</span><span class="n">RADL_MODULE</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the indirection, since we are in the generic case, the field
<code class="docutils literal"><span class="pre">x</span></code> is a pointer to its value. To access <code class="docutils literal"><span class="pre">a</span></code>, since it is inside
a <code class="docutils literal"><span class="pre">topic</span></code>, we don&#8217;t need the indirection:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">RADL_MODULE</span><span class="o">-&gt;</span><span class="n">t</span><span class="o">.</span><span class="n">a</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">t</span></code> is a topic so it is not a pointer, its field are
accessed directly. Same things apply for any other value, for example
to read &#8220;nodes/example&#8221;, one will do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">(</span><span class="n">RADL_MODULE</span><span class="o">-&gt;</span><span class="n">n</span><span class="o">-&gt;</span><span class="n">working_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>or, when writing the step function for <code class="docutils literal"><span class="pre">n</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">(</span><span class="n">RADL_THIS</span><span class="o">-&gt;</span><span class="n">working_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that in order to access this value, we gave it a name in the
radl description. Finally, to sum it up all, to access <code class="docutils literal"><span class="pre">z</span></code> when
writing the step function of <code class="docutils literal"><span class="pre">n</span></code>, one will do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">RADL_THIS</span><span class="o">-&gt;</span><span class="n">s</span><span class="o">.</span><span class="n">z</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">File constraints</a></li>
<li><a class="reference internal" href="#meta-syntax-rules">Meta syntax rules</a><ul>
<li><a class="reference internal" href="#grammar">Grammar</a></li>
<li><a class="reference internal" href="#grammar-terminals">Grammar terminals</a></li>
<li><a class="reference internal" href="#keywords">Keywords</a></li>
<li><a class="reference internal" href="#white-spaces">White spaces</a></li>
<li><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#identifier-scoping-rules">Identifier scoping rules</a><ul>
<li><a class="reference internal" href="#scoping-regions">Scoping regions</a></li>
<li><a class="reference internal" href="#local-unicity-of-names">Local unicity of names</a></li>
<li><a class="reference internal" href="#global-unicity-of-qualified-names">Global unicity of qualified names</a></li>
<li><a class="reference internal" href="#resolution-of-identifiers-to-qualified-names">Resolution of identifiers to qualified names</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shadowing">Shadowing</a><ul>
<li><a class="reference internal" href="#id1">Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#the-radler-language">The radler language</a><ul>
<li><a class="reference internal" href="#logical-level">Logical level</a><ul>
<li><a class="reference internal" href="#nodes">Nodes</a></li>
<li><a class="reference internal" href="#topics">Topics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#external-files-and-path">External files and <code class="docutils literal"><span class="pre">PATH</span></code></a><ul>
<li><a class="reference internal" href="#file-reference">File reference</a></li>
<li><a class="reference internal" href="#working-directory-of-a-region-path-and-module-base-path">Working directory of a region, <code class="docutils literal"><span class="pre">PATH</span></code> and <code class="docutils literal"><span class="pre">MODULE_BASE_PATH</span></code></a></li>
<li><a class="reference internal" href="#id2">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#libraries">Libraries</a><ul>
<li><a class="reference internal" href="#static-library">Static library</a></li>
<li><a class="reference internal" href="#cmake-library">Cmake library</a></li>
</ul>
</li>
<li><a class="reference internal" href="#typing">Typing</a><ul>
<li><a class="reference internal" href="#inference">Inference</a></li>
<li><a class="reference internal" href="#checking">Checking</a></li>
<li><a class="reference internal" href="#subtyping">Subtyping</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#user-code">User code</a><ul>
<li><a class="reference internal" href="#compilation">Compilation</a><ul>
<li><a class="reference internal" href="#include-directories">Include directories</a></li>
<li><a class="reference internal" href="#compiler-definitions">Compiler definitions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#c-node-definition">C++ node definition</a><ul>
<li><a class="reference internal" href="#the-input-structure-radl-in-t">The input structure <code class="docutils literal"><span class="pre">radl_in_t</span></code></a></li>
<li><a class="reference internal" href="#the-output-structure-radl-out-t">The output structure <code class="docutils literal"><span class="pre">radl_out_t</span></code></a></li>
<li><a class="reference internal" href="#the-flag-structures-radl-in-flags-t-radl-out-flags-t">The flag structures <code class="docutils literal"><span class="pre">radl_in_flags_t</span></code>, <code class="docutils literal"><span class="pre">radl_out_flags_t</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">C node definition</a></li>
<li><a class="reference internal" href="#the-flags">The flags</a><ul>
<li><a class="reference internal" href="#computation-of-the-output-flags">Computation of the output flags</a></li>
<li><a class="reference internal" href="#computation-of-the-input-flag-radl-stale">Computation of the input flag <code class="docutils literal"><span class="pre">radl_STALE</span></code></a></li>
<li><a class="reference internal" href="#computation-of-the-input-flag-radl-timeout">Computation of the input flag <code class="docutils literal"><span class="pre">radl_TIMEOUT</span></code></a></li>
<li><a class="reference internal" href="#turning-off-on-output-flags">Turning off/on output flags</a></li>
</ul>
</li>
<li><a class="reference internal" href="#introspection">Introspection</a><ul>
<li><a class="reference internal" href="#modules-root-entries">Modules root entries</a></li>
<li><a class="reference internal" href="#shortcuts">Shortcuts</a></li>
<li><a class="reference internal" href="#field-access">Field access</a></li>
<li><a class="reference internal" href="#the-defs-field">The <code class="docutils literal"><span class="pre">DEFS</span></code> field</a></li>
<li><a class="reference internal" href="#id4">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/radler_language.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">RadlerManual 1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, SRI International.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.
    </div>
  </body>
</html>